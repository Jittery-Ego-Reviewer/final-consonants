<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²µèªå°¾éŸ³æŒ‘æˆ°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0fdf4; /* Light Green bg */
            touch-action: manipulation;
        }

        .card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .card:active {
            transform: scale(0.95);
        }

        /* Shake animation for wrong answer */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            50% { transform: translateX(10px) rotate(5deg); }
            75% { transform: translateX(-10px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
            background-color: #fee2e2 !important; /* Red-100 */
            border-color: #ef4444 !important; /* Red-500 */
        }

        /* Pop animation for correct answer */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .pop {
            animation: pop 0.3s ease-out;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-4">

    <!-- GAME CONTAINER -->
    <div class="w-full max-w-lg bg-white rounded-3xl shadow-xl overflow-hidden border-4 border-green-200 relative min-h-[600px] flex flex-col">
        
        <!-- HEADER (Score) -->
        <div class="bg-green-500 p-4 text-white flex justify-between items-center shadow-md z-10">
            <!-- Home Button -->
            <button onclick="goHome()" class="flex items-center text-white bg-green-600 hover:bg-green-700 px-3 py-1 rounded-lg transition text-sm font-bold">
                <span class="mr-1">ğŸ </span> ä¸»é 
            </button>
            <div class="font-bold text-xl absolute left-1/2 transform -translate-x-1/2">å°¾éŸ³æŒ‘æˆ°</div>
            <div class="bg-green-700 px-4 py-1 rounded-full font-mono text-lg" id="score-display">åˆ†: 0</div>
        </div>

        <!-- 1. MENU SCREEN -->
        <div id="menu-screen" class="flex-1 flex flex-col items-center justify-center p-6 space-y-6">
            <h1 class="text-2xl font-bold text-gray-800 text-center mb-4">è«‹é¸æ“‡ç·´ç¿’æ¨¡å¼</h1>
            
            <button onclick="startGame('pt')" class="w-full bg-blue-100 hover:bg-blue-200 border-2 border-blue-400 p-6 rounded-2xl text-left transition transform hover:-translate-y-1 shadow-md relative overflow-hidden group">
                <div class="relative z-10">
                    <div class="text-2xl font-bold text-blue-800 text-center">/-p/ vs /-t/</div>
                    <div class="text-center text-blue-600 text-sm mt-1 mb-2">é´¨ vs å…«</div>
                    <div class="flex justify-center">
                        <span class="text-xs font-bold text-blue-500 bg-white/60 px-2 py-1 rounded-full">
                            ğŸ‘‘ æœ€é«˜åˆ†: <span id="hs-pt">0</span>
                        </span>
                    </div>
                </div>
            </button>

            <button onclick="startGame('pk')" class="w-full bg-orange-100 hover:bg-orange-200 border-2 border-orange-400 p-6 rounded-2xl text-left transition transform hover:-translate-y-1 shadow-md relative overflow-hidden group">
                <div class="relative z-10">
                    <div class="text-2xl font-bold text-orange-800 text-center">/-p/ vs /-k/</div>
                    <div class="text-center text-orange-600 text-sm mt-1 mb-2">é´¨ vs å®…</div>
                    <div class="flex justify-center">
                        <span class="text-xs font-bold text-orange-500 bg-white/60 px-2 py-1 rounded-full">
                            ğŸ‘‘ æœ€é«˜åˆ†: <span id="hs-pk">0</span>
                        </span>
                    </div>
                </div>
            </button>

            <button onclick="startGame('mn')" class="w-full bg-purple-100 hover:bg-purple-200 border-2 border-purple-400 p-6 rounded-2xl text-left transition transform hover:-translate-y-1 shadow-md relative overflow-hidden group">
                <div class="relative z-10">
                    <div class="text-2xl font-bold text-purple-800 text-center">/-m/ vs /-n/</div>
                    <div class="text-center text-purple-600 text-sm mt-1 mb-2">å— vs é›£</div>
                    <div class="flex justify-center">
                        <span class="text-xs font-bold text-purple-500 bg-white/60 px-2 py-1 rounded-full">
                            ğŸ‘‘ æœ€é«˜åˆ†: <span id="hs-mn">0</span>
                        </span>
                    </div>
                </div>
            </button>
        </div>

        <!-- 2. GAME SCREEN -->
        <div id="game-screen" class="hidden flex-1 flex flex-col p-6">
            <!-- Progress Bar -->
            <div class="flex justify-between text-xs text-gray-500 mb-1 px-1">
                <span>é€²åº¦</span>
                <span id="trial-counter">1 / 15</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                <div id="progress-bar" class="bg-green-500 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>

            <!-- Instruction -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8 rounded-r shadow-sm">
                <p class="text-gray-500 text-sm font-bold uppercase tracking-wide mb-1">ä»»å‹™</p>
                <p class="text-xl font-bold text-gray-800 leading-relaxed" id="instruction-text">
                    è«‹é¸æ“‡å«æœ‰...
                </p>
            </div>

            <!-- Cards Grid -->
            <div class="grid grid-cols-2 gap-6 mt-auto mb-auto">
                <!-- Left Card Container -->
                <div class="flex flex-col items-center">
                    <button id="card-left" onclick="handleCardClick('left')" class="w-full card h-40 bg-white border-4 border-gray-200 rounded-3xl flex items-center justify-center shadow-lg active:shadow-inner text-6xl font-bold text-gray-800 mb-3">
                        å­—
                    </button>
                    <button onclick="playTTS('left')" class="flex items-center gap-1 bg-white border border-gray-300 text-gray-600 hover:bg-blue-50 hover:text-blue-600 px-3 py-2 rounded-full text-sm font-bold transition shadow-sm active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                        </svg>
                        <span>è½ç™¼éŸ³</span>
                    </button>
                </div>

                <!-- Right Card Container -->
                <div class="flex flex-col items-center">
                    <button id="card-right" onclick="handleCardClick('right')" class="w-full card h-40 bg-white border-4 border-gray-200 rounded-3xl flex items-center justify-center shadow-lg active:shadow-inner text-6xl font-bold text-gray-800 mb-3">
                        å­—
                    </button>
                    <button onclick="playTTS('right')" class="flex items-center gap-1 bg-white border border-gray-300 text-gray-600 hover:bg-blue-50 hover:text-blue-600 px-3 py-2 rounded-full text-sm font-bold transition shadow-sm active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                        </svg>
                        <span>è½ç™¼éŸ³</span>
                    </button>
                </div>
            </div>
            
            <div class="h-10 text-center mt-4 text-gray-400 text-sm" id="timer-bonus">
                <!-- Bonus text will appear here -->
            </div>
        </div>

        <!-- 3. FEEDBACK OVERLAY (Modal) -->
        <div id="feedback-screen" class="hidden absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full rounded-3xl p-6 shadow-2xl transform scale-100 transition-transform animate-[pop_0.3s_ease-out]">
                <div class="text-center">
                    <div class="inline-block p-3 rounded-full bg-green-100 text-green-600 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <h2 class="text-3xl font-bold text-green-600 mb-2">æ­£ç¢ºï¼</h2>
                    <p class="text-gray-500 mb-6" id="feedback-bonus-text">+100 åˆ†</p>
                </div>

                <!-- Comparison Display -->
                <div class="flex justify-center gap-4 mb-8">
                    <!-- Left Item (Feedback) -->
                    <div class="flex-1 bg-gray-50 rounded-xl p-4 flex flex-col items-center border-2" id="fb-left-container">
                        <div class="text-4xl font-bold text-gray-800 mb-2 cursor-pointer hover:text-blue-600" onclick="playText(this.innerText)" id="fb-left-char">å­—</div>
                        <div class="text-lg font-mono text-gray-500 bg-gray-200 px-2 rounded" id="fb-left-jyut">jyut</div>
                        <button onclick="playText(document.getElementById('fb-left-char').innerText)" class="mt-2 text-gray-400 hover:text-blue-500">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Right Item (Feedback) -->
                    <div class="flex-1 bg-gray-50 rounded-xl p-4 flex flex-col items-center border-2" id="fb-right-container">
                        <div class="text-4xl font-bold text-gray-800 mb-2 cursor-pointer hover:text-blue-600" onclick="playText(this.innerText)" id="fb-right-char">å­—</div>
                        <div class="text-lg font-mono text-gray-500 bg-gray-200 px-2 rounded" id="fb-right-jyut">jyut</div>
                        <button onclick="playText(document.getElementById('fb-right-char').innerText)" class="mt-2 text-gray-400 hover:text-blue-500">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <button id="feedback-next-btn" onclick="nextRound()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl text-xl shadow-lg transition transform active:scale-95">
                    ç¹¼çºŒ Next
                </button>
            </div>
        </div>

        <!-- 4. GAME OVER SCREEN -->
        <div id="game-over-screen" class="hidden absolute inset-0 bg-white z-50 flex flex-col items-center justify-center p-6 text-center animate-[pop_0.3s_ease-out]">
            <div class="mb-6 text-6xl">ğŸ†</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">ç·´ç¿’å®Œæˆï¼</h2>
            <p class="text-gray-500 mb-8">åšå¾—å¥½ï¼ç¹¼çºŒåŠªåŠ›ï¼</p>
            
            <div class="bg-green-50 rounded-2xl p-6 w-full mb-8 border-2 border-green-100">
                <div class="text-sm text-gray-500 uppercase tracking-wide">æœ€çµ‚å¾—åˆ†</div>
                <div class="text-5xl font-bold text-green-600 mt-2" id="final-score">0</div>
                <div class="mt-2 text-sm text-green-500 font-bold hidden" id="new-record-badge">âœ¨ æ–°ç´€éŒ„ï¼ New Record!</div>
            </div>

            <button onclick="goHome()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 rounded-xl text-xl shadow-lg transition transform active:scale-95 mb-4">
                è¿”å›ä¸»é  Home
            </button>
        </div>

    </div>

    <script>
        // --- DATA SETS ---
        
        const DATA_PT = [
            { p: "è²¼", p_jp: "tip7", t: "éµ", t_jp: "tit7" },
            { p: "åˆ", p_jp: "hap9", t: "æ ¸", t_jp: "hat9" },
            { p: "å", p_jp: "sap9", t: "å¯¦", t_jp: "sat9" },
            { p: "é´¨", p_jp: "aap8", t: "å£“", t_jp: "aat8" },
            { p: "è Ÿ", p_jp: "laap9", t: "è¾£", t_jp: "laat9" },
            { p: "å…¥", p_jp: "jap9", t: "æ—¥", t_jp: "jat9" },
            { p: "æ‹¾", p_jp: "sap9", t: "å¯¦", t_jp: "sat9" },
            { p: "æ¿•", p_jp: "sap7", t: "å®¤", t_jp: "sat7" },
            { p: "åŸ·", p_jp: "zap7", t: "è³ª", t_jp: "zat7" },
            { p: "å¸", p_jp: "kap7", t: "å’³", t_jp: "kat7" },
            { p: "æ³£", p_jp: "jap7", t: "ä¸€", t_jp: "jat7" },
            { p: "æ‘º", p_jp: "zip8", t: "æŠ˜", t_jp: "zit8" },
            { p: "è‘‰", p_jp: "jip9", t: "ç†±", t_jp: "jit9" },
            { p: "ç·", p_jp: "cap7", t: "ä¸ƒ", t_jp: "cat7" },
            { p: "æ’", p_jp: "caap8", t: "æ“¦", t_jp: "caat8" },
            { p: "æ€¥", p_jp: "gap7", t: "å‰", t_jp: "gat7" }
        ];

        const DATA_PK = [
            { p: "æ’", p_jp: "caap8", k: "æ‹†", k_jp: "caak8" },
            { p: "å¤¾", p_jp: "gaap8", k: "æ ¼", k_jp: "gaak8" },
            { p: "ç«‹", p_jp: "lap9", k: "å‹’", k_jp: "lak9" },
            { p: "ç«‹", p_jp: "lap9", k: "è‚‹", k_jp: "lak9" },
            { p: "é–˜", p_jp: "zaap9", k: "æ“‡", k_jp: "zaak9" },
            { p: "è¥²", p_jp: "zaap9", k: "å®…", k_jp: "zaak9" },
            { p: "é›œ", p_jp: "zaap9", k: "æ“‡", k_jp: "zaak9" },
            { p: "è¥²", p_jp: "zaap6", k: "æ‘˜", k_jp: "zaak3" },
            { p: "ç¿’", p_jp: "zaap9", k: "æ“²", k_jp: "zaak9" },
            { p: "é›†", p_jp: "zaap9", k: "å®…", k_jp: "zaak9" }
        ];

        const DATA_MN = [
            { m: "å—", m_jp: "naam4", n: "é›£", n_jp: "naan4" },
            { m: "å°‹", m_jp: "cam4", n: "å¡µ", n_jp: "can4" },
            { m: "æ„Ÿ", m_jp: "gam2", n: "ç·Š", n_jp: "gan2" },
            { m: "å¿ƒ", m_jp: "sam1", n: "æ–°", n_jp: "san1" },
            { m: "æ£®", m_jp: "sam1", n: "æ–°", n_jp: "san1" },
            { m: "æµ¸", m_jp: "zam3", n: "éœ‡", n_jp: "zan3" },
            { m: "è—", m_jp: "laam4", n: "è˜­", n_jp: "laan4" },
            { m: "åƒ", m_jp: "caam1", n: "é¤", n_jp: "caan1" },
            { m: "ä¸‰", m_jp: "saam1", n: "å±±", n_jp: "saan1" }
        ];

        // --- GAME STATE ---
        let currentMode = '';
        let currentData = [];
        let score = 0;
        let trialsCount = 0;
        const MAX_TRIALS = 15;
        let roundStartTime = 0;
        let currentPair = null;
        let targetType = ''; // 'p', 't', 'k', 'm', 'n'
        
        // --- AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playCorrectSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(500, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        // --- TTS FUNCTION ---
        function playTTS(side) {
            const btn = document.getElementById(`card-${side}`);
            if (btn) {
                playText(btn.innerText);
            }
        }

        function playText(text) {
            if (!text) return;
            
            // Override for characters with multiple pronunciations (polyphones)
            // to ensure the correct sound for this specific game context.
            const pronunciationOverrides = {
                "åƒ": "æ”™", // Force 'caam1' (participate) instead of 'sam1' (ginseng)
                "ç«‹": "ç²’", // Force 'lap' (short vowel) instead of 'laap'
            };

            const textToSpeak = pronunciationOverrides[text] || text;
            
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                
                // Try to use a Cantonese voice
                const voices = window.speechSynthesis.getVoices();
                // Common Cantonese voice identifiers: 'zh-HK', 'Cantonese', 'Sin-Ji'
                const cantoneseVoice = voices.find(v => 
                    v.lang === 'zh-HK' || 
                    v.name.includes('Cantonese') || 
                    v.name.includes('HK')
                );

                if (cantoneseVoice) {
                    utterance.voice = cantoneseVoice;
                }
                
                utterance.lang = 'zh-HK';
                utterance.rate = 0.8; // Slightly slower for clarity
                window.speechSynthesis.speak(utterance);
            } else {
                alert("æŠ±æ­‰ï¼Œæ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒèªéŸ³åŠŸèƒ½ã€‚\nSorry, your browser doesn't support Text-to-Speech.");
            }
        }

        // --- HIGHSCORE FUNCTIONS ---
        function getHighScore(mode) {
            return localStorage.getItem('cantonese_score_' + mode) || 0;
        }

        function setHighScore(mode, newScore) {
            const current = parseInt(getHighScore(mode));
            if (newScore > current) {
                localStorage.setItem('cantonese_score_' + mode, newScore);
                return true;
            }
            return false;
        }

        function updateMenuHighScores() {
            document.getElementById('hs-pt').innerText = getHighScore('pt');
            document.getElementById('hs-pk').innerText = getHighScore('pk');
            document.getElementById('hs-mn').innerText = getHighScore('mn');
        }

        // --- CORE FUNCTIONS ---
        
        // Init logic
        window.onload = function() {
            updateMenuHighScores();
            // Pre-load voices
            if ('speechSynthesis' in window) {
                window.speechSynthesis.getVoices();
            }
        };

        function goHome() {
            // Hide all game screens
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('feedback-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            
            // Show Menu
            document.getElementById('menu-screen').classList.remove('hidden');
            
            // Update scores incase they changed
            updateMenuHighScores();

            // Reset Score UI just in case
            score = 0;
            document.getElementById('score-display').innerText = `åˆ†: 0`;
        }

        function startGame(mode) {
            currentMode = mode;
            score = 0;
            trialsCount = 0; // Reset trials
            document.getElementById('score-display').innerText = `åˆ†: ${score}`;
            
            // Switch screens
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('new-record-badge').classList.add('hidden');

            // Select Data
            if (mode === 'pt') currentData = [...DATA_PT];
            else if (mode === 'pk') currentData = [...DATA_PK];
            else if (mode === 'mn') currentData = [...DATA_MN];

            // Shuffle Data
            currentData.sort(() => Math.random() - 0.5);

            nextRound();
        }

        function nextRound() {
            // Check if game over
            if (trialsCount >= MAX_TRIALS) {
                endGame();
                return;
            }

            // Hide feedback
            document.getElementById('feedback-screen').classList.add('hidden');
            
            // Increment Trial
            trialsCount++;
            updateProgress();

            // Pick a random pair from the set
            const pairIndex = Math.floor(Math.random() * currentData.length);
            currentPair = currentData[pairIndex];

            // Determine Target (e.g., asked to find P or T?)
            const types = currentMode.split(''); // ['p', 't'] or ['p', 'k'] or ['m', 'n']
            targetType = types[Math.floor(Math.random() * types.length)];

            // Setup UI
            renderRound();
            
            roundStartTime = Date.now();
        }

        function updateProgress() {
            const progressBar = document.getElementById('progress-bar');
            const counterText = document.getElementById('trial-counter');
            
            const percent = (trialsCount / MAX_TRIALS) * 100;
            progressBar.style.width = `${percent}%`;
            counterText.innerText = `${trialsCount} / ${MAX_TRIALS}`;
        }

        function endGame() {
            document.getElementById('feedback-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.remove('hidden');
            
            document.getElementById('final-score').innerText = score;

            // Check High Score
            const isNewRecord = setHighScore(currentMode, score);
            if (isNewRecord) {
                document.getElementById('new-record-badge').classList.remove('hidden');
            }
        }

        function getLabel(type) {
            switch(type) {
                case 'p': return { text: 'ã€Œé´¨ã€å°¾éŸ³ /-p/', color: 'text-blue-600' };
                case 't': return { text: 'ã€Œå…«ã€å°¾éŸ³ /-t/', color: 'text-blue-600' };
                case 'k': return { text: 'ã€Œå®…ã€å°¾éŸ³ /-k/', color: 'text-orange-600' };
                case 'm': return { text: 'ã€Œå—ã€å°¾éŸ³ /-m/', color: 'text-purple-600' };
                case 'n': return { text: 'ã€Œé›£ã€å°¾éŸ³ /-n/', color: 'text-purple-600' };
                default: return { text: '', color: '' };
            }
        }

        function renderRound() {
            const labelData = getLabel(targetType);
            
            // Set Instruction
            const instructionEl = document.getElementById('instruction-text');
            instructionEl.innerHTML = `è«‹é¸æ“‡å«æœ‰<br><span class="${labelData.color} text-2xl">${labelData.text}</span> çš„å­—è©`;

            // Randomize position (Left vs Right)
            const isLeftTarget = Math.random() > 0.5;

            const leftBtn = document.getElementById('card-left');
            const rightBtn = document.getElementById('card-right');

            // Reset styles
            leftBtn.classList.remove('shake');
            rightBtn.classList.remove('shake');

            // Set Content
            if (isLeftTarget) {
                // Left is correct answer
                leftBtn.innerText = currentPair[targetType];
                rightBtn.innerText = currentPair[getOppositeType()];
                leftBtn.dataset.type = targetType;
                rightBtn.dataset.type = getOppositeType();
            } else {
                // Right is correct answer
                leftBtn.innerText = currentPair[getOppositeType()];
                rightBtn.innerText = currentPair[targetType];
                leftBtn.dataset.type = getOppositeType();
                rightBtn.dataset.type = targetType;
            }
        }

        function getOppositeType() {
            const types = currentMode.split('');
            return types[0] === targetType ? types[1] : types[0];
        }

        function handleCardClick(side) {
            const btn = document.getElementById(`card-${side}`);
            const selectedType = btn.dataset.type;

            if (selectedType === targetType) {
                // CORRECT
                playCorrectSound();
                
                // Calculate Score (Base 100 + Speed Bonus)
                const timeTaken = (Date.now() - roundStartTime) / 1000;
                let bonus = 0;
                if (timeTaken < 1.5) bonus = 50;
                else if (timeTaken < 3) bonus = 20;
                
                const roundScore = 100 + bonus;
                score += roundScore;
                
                // Update Score UI
                document.getElementById('score-display').innerText = `åˆ†: ${score}`;
                document.getElementById('feedback-bonus-text').innerText = timeTaken < 1.5 ? "é€Ÿåº¦æ¥µå¿«ï¼ +150 åˆ†" : "+100 åˆ†";

                showFeedback(roundScore);
            } else {
                // WRONG
                btn.classList.add('shake');
                // Remove shake class after animation so it can be triggered again
                setTimeout(() => {
                    btn.classList.remove('shake');
                }, 400);
            }
        }

        function showFeedback(points) {
            const modal = document.getElementById('feedback-screen');
            modal.classList.remove('hidden');
            
            // Update Button Text if it's the last round
            const nextBtn = document.getElementById('feedback-next-btn');
            if (trialsCount >= MAX_TRIALS) {
                nextBtn.innerText = "å®Œæˆ Finish";
            } else {
                nextBtn.innerText = "ç¹¼çºŒ Next";
            }

            // Configure Feedback Cards
            const leftContainer = document.getElementById('fb-left-container');
            const rightContainer = document.getElementById('fb-right-container');
            
            const targetCode = targetType;
            const otherCode = getOppositeType();
            
            document.getElementById('fb-left-char').innerText = currentPair[targetCode];
            document.getElementById('fb-left-jyut').innerText = currentPair[targetCode + "_jp"];
            
            document.getElementById('fb-right-char').innerText = currentPair[otherCode];
            document.getElementById('fb-right-jyut').innerText = currentPair[otherCode + "_jp"];

            // Styling highlight
            leftContainer.className = "flex-1 bg-green-50 border-4 border-green-400 rounded-xl p-4 flex flex-col items-center shadow-lg transform scale-105";
            rightContainer.className = "flex-1 bg-gray-50 border-2 border-gray-200 rounded-xl p-4 flex flex-col items-center opacity-70";
        }

    </script>
</body>
</html>
